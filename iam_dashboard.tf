# Copyright (c) 2021 Oracle and/or its affiliates.
# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.


locals { 
    iam_dashboard_details = "{\"dashboards\":[{\"dashboardId\":\"IAMDASHBOARD\",\"providerId\":\"log-analytics\",\"providerName\":\"Logging Analytics\",\"providerVersion\":\"3.0.0\",\"tiles\":[{\"displayName\":\"Successful Logins per day\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaa3idkib7u7h3ufzkxgkkfvhdrkurlusm74zsg7ctj757p4espwb2q\",\"row\":0,\"column\":0,\"height\":4,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}},{\"displayName\":\"Password Recoveries per day\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaaktop4ltwy4mi4swmhxksmurdvvip4s7v3zondf5qfylmv4yyzduq\",\"row\":4,\"column\":6,\"height\":4,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}},{\"displayName\":\"Account Locks per day\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaaoaiprdzduajze6px7lgm2feoxqtluviuzx3uhimhcyn464nsqjaa\",\"row\":8,\"column\":0,\"height\":4,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}},{\"displayName\":\"New Users per day\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaaauawjakrnwysbgy4zzolu5utdptlofqvxx46llijv6kjc2v5tpoq\",\"row\":4,\"column\":0,\"height\":4,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}},{\"displayName\":\"Unsuccessful Logins per day\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaamtaeg6xjacns7vg5shwgih4u4ugdej5rzfv66etgt7gdtp6mdhva\",\"row\":0,\"column\":6,\"height\":4,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}},{\"displayName\":\"New Users by Source\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaalyiq4b3q6lidhf3t3mydtxbex6z3prhc6r2ljw6a4345fyj7csnq\",\"row\":8,\"column\":6,\"height\":4,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}},{\"displayName\":\"New Users by Source Type\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaa7ziobofzkkvm3ci4k7347pp3gjtuii7cewzarwxx4v6nuffpzn4a\",\"row\":12,\"column\":6,\"height\":3,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}},{\"displayName\":\"Events Generated by Users\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaaqo7q7s4jjb5iaxklmsvy3bgbwyeqg27qldnqvr566yiiar7l4tjq\",\"row\":12,\"column\":0,\"height\":3,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}},{\"displayName\":\"Geostats for Unsuccessful Logins\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaaj4jxcldhoxqwxdyqtmoj42u3k4byv2go7wfznujwm3t7fclls4sa\",\"row\":19,\"column\":5,\"height\":5,\"width\":7,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}},{\"displayName\":\"Application Access\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaaxqeu4ph6mfheuglhvkscrjbn6ad3eajuv3xtmcn253ml3acqcz3a\",\"row\":15,\"column\":0,\"height\":4,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\",\"log-analytics-log-set\":\"$(dashboard.params.log-analytics-logset-filter)\"}},{\"displayName\":\"Application Role Privileges\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaampi5tnceumordnwmburcibgoerai7cqmukxtbmft2yrstyqqhvmq\",\"row\":15,\"column\":6,\"height\":4,\"width\":6,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\",\"log-analytics-log-set\":\"$(dashboard.params.log-analytics-logset-filter)\"}},{\"displayName\":\"Dormant Users (30 Days)\",\"savedSearchId\":\"SAVEDSEARCH..aaaaaaaajjab5buyirt7xmskdq4dd4bwiwkx46yd5higy2dxll7gb4hbxv6a\",\"row\":19,\"column\":0,\"height\":5,\"width\":5,\"nls\":{},\"uiConfig\":{},\"dataConfig\":[],\"state\":\"DEFAULT\",\"drilldownConfig\":[],\"parametersMap\":{\"log-analytics-entity\":\"$(dashboard.params.log-analytics-entity-filter)\",\"log-analytics-log-group-compartment\":\"$(dashboard.params.log-analytics-loggroup-filter)\"}}],\"displayName\":\"${var.iam_dashboard_domainname} Identity Domain\",\"description\":\"\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobDashboard\":false,\"isShowInHome\":false,\"metadataVersion\":\"2.0\",\"isShowDescription\":true,\"screenImage\":\"todo: provide value[mandatory]\",\"nls\":{},\"uiConfig\":{\"isFilteringEnabled\":false,\"isRefreshEnabled\":true,\"isTimeRangeEnabled\":true},\"dataConfig\":[],\"type\":\"normal\",\"isFavorite\":false,\"savedSearches\":[{\"id\":\"SAVEDSEARCH..aaaaaaaa7ziobofzkkvm3ci4k7347pp3gjtuii7cewzarwxx4v6nuffpzn4a\",\"displayName\":\"New Users by Source Type\",\"providerId\":\"log-analytics\",\"providerVersion\":\"3.0.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"New Users by Source Type (Actor Type)\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM Domain Name' = ${var.iam_dashboard_domainname} and 'IAM EventID' = admin.user.create.success | stats count by 'IAM Actor Type'\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"timePeriod\":\"l7day\"},\"visualizationOptions\":{\"customVizOpt\":{\"primaryFieldIname\":\"mbody\"}},\"visualizationType\":\"pie\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"visualizations/chartWidgetTemplate.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-4a\"],\"displayName\":\"Log Group Compartment\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-log-group-compartment\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-2a\"],\"displayName\":\"Entity\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-entity\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-3a\"],\"displayName\":\"Log Set\",\"editUi\":{\"inputType\":\"none\"},\"hidden\":\"$(window.logSetNotEnabled)\",\"name\":\"log-analytics-log-set\",\"required\":true}],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaajjab5buyirt7xmskdq4dd4bwiwkx46yd5higy2dxll7gb4hbxv6a\",\"displayName\":\"Dormant Users (30 Days)\",\"providerId\":\"log-analytics\",\"providerVersion\":\"3.0.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"queryString\":\"Time between * and * and 'IAM Domain Name' = ${var.iam_dashboard_domainname} and 'IAM EventID' = sso.session.create.success | stats latest('Event End Time') as 'Last Login' by 'User Name' | where 'Last Login' \\u003c dateRelative(30day) | sort -'Last Login'\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":false},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"LogSet\":{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},\"MetricCompartment\":{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},\"ResourceCompartment\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":false},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},{\"flags\":{\"includeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"timePeriod\":\"l7day\"},\"visualizationOptions\":{\"customVizOpt\":{\"LINK_CLASSIFY_SETTINGS\":{\"Dormant Users\":{\"chartHeight\":200,\"chartType\":[\"trend\"],\"classifyColorPalette\":{\"1\":\"default\",\"7\":\"func2_unique_udfs4\",\"8\":\"default\",\"9\":\"usrname\"},\"classifyColorPaletteCustom\":{\"7\":{},\"9\":{}},\"classifyFilters\":{\"classifyNarrowResults\":[\"on\"],\"selectAllFilters\":[\"on\"],\"selectedClassifyFilters\":[6,7,8],\"showClassifyFilters\":[]},\"colorColumn\":9,\"descendingXAxis\":[null],\"descendingYAxis\":[null],\"drilldown\":\"on\",\"groupAlias\":\"Groups\",\"groupAliasS\":\"Group\",\"showAnomaly\":[\"off\"],\"showBaseline\":[\"off\"],\"showDimensions\":[\"on\"],\"sizeColumn\":8,\"swapXY\":[\"off\"],\"zeroXAxis\":[\"on\"],\"zeroYAxis\":[\"on\"]}},\"LINK_SEARCH_SETTINGS\":{\"chartHeightVal\":200,\"chartOptions\":[\"bar\"],\"chartType\":\"bar\",\"chartWidthVal\":60,\"columnAliases\":{},\"dashboardOptions\":{\"showAnalyzeTab\":[],\"showChartsTab\":[],\"showSummary\":[],\"showTable\":[],\"showTabs\":[\"on\"]},\"groupAliasP\":\"Groups\",\"groupAliasS\":\"Group\",\"hiddenCharts\":{\"groupColumn\":true},\"hiddenClassifyCharts\":{},\"hiddenColumns\":{\"g_duration\":true,\"g_endepoch\":true,\"g_startepoch\":true,\"query_end_time\":true,\"query_start_time\":true,\"trend_interval\":true,\"trend_interval_unit\":true},\"highlightColumnStatus\":{},\"linkSummaryInput\":\"\",\"logAliasP\":\"Log Records\",\"mergeHighlightColumns\":[],\"showAllRegions\":[],\"showCombinedCharts\":[\"off\"],\"showNonUnitRawData\":[],\"showStack\":[\"off\"],\"showToolTips\":[\"on\"],\"showUnitRawData\":[],\"smartGroup\":[\"off\"],\"styleDefaults\":{\"lineType\":\"curved\",\"markerDisplayed\":\"on\"}}}},\"visualizationType\":\"summary_table\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"visualizations/chartWidgetTemplate.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-4a\"],\"displayName\":\"Log Group Compartment\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-log-group-compartment\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-2a\"],\"displayName\":\"Entity\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-entity\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-3a\"],\"displayName\":\"Log Set\",\"editUi\":{\"inputType\":\"none\"},\"hidden\":\"$(window.logSetNotEnabled)\",\"name\":\"log-analytics-log-set\",\"required\":true}],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaa3idkib7u7h3ufzkxgkkfvhdrkurlusm74zsg7ctj757p4espwb2q\",\"displayName\":\"Successful Logins per day\",\"providerId\":\"log-analytics\",\"providerVersion\":\"2.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"Successful Logins per day\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"internalKey\":\"SEARCHaaaaaaaaqobrfkz6rfxvcy52d2hdxnj3ufwke4tz2bndz5eb5jtxa45lqphq\",\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM EventID' = sso.session.create.success and 'IAM Domain Name' = ${var.iam_dashboard_domainname} | fields -Entity, -'Entity Type', -'Host Name (Server)', -'Problem Priority', -Label, -'Log Source', 'User Name', -'IAM Domain Name' | timestats span = 1day count\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"numUnits\":1,\"timePeriod\":\"relative\",\"units\":\"YEARS\"},\"visualizationOptions\":{\"customVizOpt\":{\"GEOMAP_SETTINGS\":{\"basemap\":\"bi_world_map_light\",\"clusterColor\":\"rgb(192, 192, 192)\",\"filterOnZoom\":false,\"isShowLegend\":true,\"lat\":2273030.9269876885,\"lon\":0,\"mapZoom\":1,\"pointColor\":\"rgb(0, 0, 255)\",\"srid\":3857,\"toggleClusters\":false},\"primaryFieldIname\":\"mbody\"}},\"visualizationType\":\"table_histogram\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaamtaeg6xjacns7vg5shwgih4u4ugdej5rzfv66etgt7gdtp6mdhva\",\"displayName\":\"Unsuccessful Logins per day\",\"providerId\":\"log-analytics\",\"providerVersion\":\"2.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"Unsuccessful Logins per day\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"internalKey\":\"SEARCHaaaaaaaavcqltlgtxccrimky2pfft6ihm2ltrnv3vxrv3iled7x4stjb4oza\",\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM EventID' = sso.authentication.failure and 'IAM Domain Name' = ${var.iam_dashboard_domainname} | fields -Entity, -'Entity Type', -'Host Name (Server)', -'Problem Priority', -Label, -'Log Source', 'User Name', -'IAM Domain Name' | timestats span = 1day count\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"LogSet\":{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},\"MetricCompartment\":{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},\"ResourceCompartment\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},{\"flags\":{\"includeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"timePeriod\":\"l7day\"},\"visualizationOptions\":{\"customVizOpt\":{\"primaryFieldIname\":\"mbody\"}},\"visualizationType\":\"table_histogram\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaaj4jxcldhoxqwxdyqtmoj42u3k4byv2go7wfznujwm3t7fclls4sa\",\"displayName\":\"Geostats for Unsuccessful Logins\",\"providerId\":\"log-analytics\",\"providerVersion\":\"3.0.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"Geostats for Unsuccessful Logins\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"internalKey\":\"SAVEDSEARCH..aaaaaaaaj4jxcldhoxqwxdyqtmoj42u3k4byv2go7wfznujwm3t7fclls4sa\",\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM EventID' = sso.authentication.failure and 'IAM Domain Name' = ${var.iam_dashboard_domainname} | geostats count as logrecords by 'IAM Client IP', 'User Name'\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"timePeriod\":\"l7day\"},\"visualizationOptions\":{\"customVizOpt\":{\"GEOMAP_SETTINGS\":{\"basemap\":\"bi_world_map_light\",\"clusterColor\":\"rgb(192, 192, 192)\",\"filterOnZoom\":false,\"isShowLegend\":false,\"lat\":2273030.9269876885,\"lon\":0,\"mapZoom\":1,\"pointColor\":\"rgb(0, 0, 255)\",\"srid\":3857,\"toggleClusters\":false},\"primaryFieldIname\":\"mbody\"}},\"visualizationType\":\"map\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"visualizations/chartWidgetTemplate.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-4a\"],\"displayName\":\"Log Group Compartment\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-log-group-compartment\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-2a\"],\"displayName\":\"Entity\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-entity\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-3a\"],\"displayName\":\"Log Set\",\"editUi\":{\"inputType\":\"none\"},\"hidden\":\"$(window.logSetNotEnabled)\",\"name\":\"log-analytics-log-set\",\"required\":true}],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaaktop4ltwy4mi4swmhxksmurdvvip4s7v3zondf5qfylmv4yyzduq\",\"displayName\":\"Password Recoveries per day\",\"providerId\":\"log-analytics\",\"providerVersion\":\"2.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"Password Recoveries per day\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM Domain Name' = ${var.iam_dashboard_domainname} and 'IAM EventID' in (admin.me.password.reset.request.success, admin.me.password.reset.success) | timestats span = 1day count\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"LogSet\":{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},\"MetricCompartment\":{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},\"ResourceCompartment\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},{\"flags\":{\"includeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"numUnits\":1,\"timePeriod\":\"relative\",\"units\":\"MONTHS\"},\"visualizationOptions\":{\"customVizOpt\":{\"primaryFieldIname\":\"mbody\"}},\"visualizationType\":\"records_histogram\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaaxqeu4ph6mfheuglhvkscrjbn6ad3eajuv3xtmcn253ml3acqcz3a\",\"displayName\":\"Application Access\",\"providerId\":\"log-analytics\",\"providerVersion\":\"3.0.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"Application Access Report\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"internalKey\":\"SEARCHaaaaaaaabpo6t3zwkglq7oy6y4fb52iqi2ou3k4ibyl6pv7bzsutwlwlqmma\",\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM Domain Name' = ${var.iam_dashboard_domainname} and 'IAM EventID' in (sso.authentication.failure, sso.session.create.success) | fields -Entity, -'Entity Type', -'Host Name (Server)', -'Problem Priority', -Label, -'Log Source', 'User Name', 'IAM EventID', 'IAM SSO RP' as Application, 'IAM Domain Name' | timestats count as logrecords by Application | sort -logrecords\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"LogSet\":{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},\"MetricCompartment\":{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},\"ResourceCompartment\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},{\"flags\":{\"includeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"numUnits\":14,\"timePeriod\":\"relative\",\"units\":\"DAYS\"},\"visualizationOptions\":{},\"visualizationType\":\"table_histogram\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"visualizations/chartWidgetTemplate.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-4a\"],\"displayName\":\"Log Group Compartment\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-log-group-compartment\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-2a\"],\"displayName\":\"Entity\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-entity\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-3a\"],\"displayName\":\"Log Set\",\"editUi\":{\"inputType\":\"none\"},\"hidden\":\"$(window.logSetNotEnabled)\",\"name\":\"log-analytics-log-set\",\"required\":true}],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaampi5tnceumordnwmburcibgoerai7cqmukxtbmft2yrstyqqhvmq\",\"displayName\":\"Application Role Privileges\",\"providerId\":\"log-analytics\",\"providerVersion\":\"3.0.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"Application Role Privileges Report\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM Domain Name' = ${var.iam_dashboard_domainname} and 'IAM EventID' in (admin.approle.add.member.success, admin.approle.remove.member.success) | fields -Entity, -'Entity Type', -'Host Name (Server)', -'Problem Priority', -Label, -'Log Source', -'IAM EventID', 'IAM Actor Name', 'IAM AppRole App' as App, 'IAM Admin Target Name', 'IAM Admin Target Type', 'IAM Domain Name', 'IAM Resource Name' as 'App Role' | timestats count as logrecords by App | sort -logrecords\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"LogSet\":{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},\"MetricCompartment\":{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},\"ResourceCompartment\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{},\"type\":\"MetricCompartment\",\"values\":[]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},{\"flags\":{\"includeSubCompartments\":true},\"type\":\"ResourceCompartment\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"timePeriod\":\"l7day\"},\"visualizationOptions\":{},\"visualizationType\":\"table_histogram\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"visualizations/chartWidgetTemplate.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-4a\"],\"displayName\":\"Log Group Compartment\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-log-group-compartment\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-2a\"],\"displayName\":\"Entity\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-entity\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-3a\"],\"displayName\":\"Log Set\",\"editUi\":{\"inputType\":\"none\"},\"hidden\":\"$(window.logSetNotEnabled)\",\"name\":\"log-analytics-log-set\",\"required\":true}],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaalyiq4b3q6lidhf3t3mydtxbex6z3prhc6r2ljw6a4345fyj7csnq\",\"displayName\":\"New Users by Source\",\"providerId\":\"log-analytics\",\"providerVersion\":\"2.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"New Users by Source\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"internalKey\":\"SAVEDSEARCH..aaaaaaaalyiq4b3q6lidhf3t3mydtxbex6z3prhc6r2ljw6a4345fyj7csnq\",\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM Domain Name' = ${var.iam_dashboard_domainname} and 'IAM EventID' = admin.user.create.success | fields 'User Name' as 'Created By' | stats count by 'IAM Actor Name'\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"timePeriod\":\"l8hr\"},\"visualizationOptions\":{\"customVizOpt\":{\"primaryFieldIname\":\"mbody\"}},\"visualizationType\":\"pie\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaaauawjakrnwysbgy4zzolu5utdptlofqvxx46llijv6kjc2v5tpoq\",\"displayName\":\"New Users per day\",\"providerId\":\"log-analytics\",\"providerVersion\":\"2.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"New Users per day\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"internalKey\":\"SAVEDSEARCH..aaaaaaaaauawjakrnwysbgy4zzolu5utdptlofqvxx46llijv6kjc2v5tpoq\",\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM EventID' = admin.user.create.success and 'IAM Domain Name' = ${var.iam_dashboard_domainname} | fields -Entity, -'Entity Type', -'Host Name (Server)', -'Problem Priority', -Label, -'Log Source', 'IAM Resource Name' as 'New User' | timestats span = 1day count\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"timePeriod\":\"l7day\"},\"visualizationOptions\":{\"customVizOpt\":{\"primaryFieldIname\":\"mbody\"}},\"visualizationType\":\"table_histogram\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaaqo7q7s4jjb5iaxklmsvy3bgbwyeqg27qldnqvr566yiiar7l4tjq\",\"displayName\":\"Events Generated by Users\",\"providerId\":\"log-analytics\",\"providerVersion\":\"3.0.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"Events Generated by Users\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM Domain Name' = ${var.iam_dashboard_domainname} and 'IAM Actor Type' = user and 'IAM EventID' like 'admin*success' | stats count as 'events generated by users' by 'User Name'\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"LogSet\":{\"flags\":{},\"type\":\"LogSet\",\"values\":[]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06gs (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},{\"flags\":{},\"type\":\"LogSet\",\"values\":[]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"numUnits\":1,\"timePeriod\":\"relative\",\"units\":\"YEARS\"},\"visualizationOptions\":{\"customVizOpt\":{\"primaryFieldIname\":\"mbody\"}},\"visualizationType\":\"treemap\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"visualizations/chartWidgetTemplate.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-4a\"],\"displayName\":\"Log Group Compartment\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-log-group-compartment\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-2a\"],\"displayName\":\"Entity\",\"editUi\":{\"inputType\":\"none\"},\"name\":\"log-analytics-entity\",\"required\":true},{\"defaultFilterIds\":[\"OOBSS-management-dashboard-filter-3a\"],\"displayName\":\"Log Set\",\"editUi\":{\"inputType\":\"none\"},\"hidden\":\"$(window.logSetNotEnabled)\",\"name\":\"log-analytics-log-set\",\"required\":true}],\"drilldownConfig\":[]},{\"id\":\"SAVEDSEARCH..aaaaaaaaoaiprdzduajze6px7lgm2feoxqtluviuzx3uhimhcyn464nsqjaa\",\"displayName\":\"Account Locks per day\",\"providerId\":\"log-analytics\",\"providerVersion\":\"2.0\",\"providerName\":\"Logging Analytics\",\"compartmentId\":\"${var.iam_dashboard_compartmentid}\",\"isOobSavedSearch\":false,\"description\":\"Account Locks per day\",\"nls\":{},\"type\":\"WIDGET_SHOW_IN_DASHBOARD\",\"uiConfig\":{\"enableWidgetInApp\":true,\"internalKey\":\"SAVEDSEARCH..aaaaaaaaoaiprdzduajze6px7lgm2feoxqtluviuzx3uhimhcyn464nsqjaa\",\"queryString\":\"'Log Source' = 'OCI Audit Logs' and 'IAM Domain Name' = ${var.iam_dashboard_domainname} and 'IAM EventID' = admin.me.locked.success | fields -Entity, -'Entity Type', -'Host Name (Server)', -'Problem Priority', -Label, -'Log Source', 'IAM Resource Name' as 'Locked User' | timestats span = 1day count\",\"scopeFilters\":{\"Entity\":{\"flags\":{\"IncludeDependents\":true,\"ScopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]},\"LogGroup\":{\"flags\":{\"IncludeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},\"filters\":[{\"flags\":{\"includeSubCompartments\":true},\"type\":\"LogGroup\",\"values\":[{\"label\":\"cc52ef7b06ashpmsignoff (root)\",\"value\":\"${var.iam_dashboard_compartmentid}\"}]},{\"flags\":{\"includeDependents\":true,\"scopeCompartmentId\":\"${var.iam_dashboard_compartmentid}\"},\"type\":\"Entity\",\"values\":[]}],\"isGlobal\":false},\"showTitle\":true,\"timeSelection\":{\"timePeriod\":\"l7day\"},\"visualizationOptions\":{\"customVizOpt\":{\"primaryFieldIname\":\"mbody\"}},\"visualizationType\":\"table_histogram\",\"vizType\":\"lxSavedSearchWidgetType\"},\"dataConfig\":[],\"screenImage\":\" \",\"metadataVersion\":\"2.0\",\"widgetTemplate\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget.html\",\"widgetVM\":\"jet-modules/dashboards/widgets/lxSavedSearchWidget\",\"freeformTags\":{},\"definedTags\":{},\"parametersConfig\":[],\"drilldownConfig\":[]}],\"parametersConfig\":[{\"column\":0,\"dataConfig\":[],\"displayName\":\"Log Group Compartment\",\"height\":1,\"localStorageKey\":\"log-analytics-loggroup-filter\",\"name\":\"log-analytics-loggroup-filter\",\"nls\":{},\"parametersMap\":{\"isStoreInLocalStorage\":true},\"row\":0,\"savedSearchId\":\"OOBSS-management-dashboard-filter-4a\",\"state\":\"DEFAULT\",\"uiConfig\":{\"defaultWidth\":3,\"filterName\":\"log-analytics-loggroup-filter\",\"internalKey\":\"OOBSS-management-dashboard-filter-4a\",\"minWidth\":3,\"vizFilterType\":\"lxLogGroupDashFilterType\"},\"width\":3},{\"column\":0,\"dataConfig\":[],\"displayName\":\"Entity\",\"height\":1,\"localStorageKey\":\"log-analytics-entity-filter\",\"name\":\"log-analytics-entity-filter\",\"nls\":{},\"parametersMap\":{\"isStoreInLocalStorage\":true},\"row\":0,\"savedSearchId\":\"OOBSS-management-dashboard-filter-2a\",\"state\":\"DEFAULT\",\"uiConfig\":{\"defaultWidth\":6,\"filterName\":\"log-analytics-entity-filter\",\"internalKey\":\"OOBSS-management-dashboard-filter-2a\",\"minWidth\":6,\"vizFilterType\":\"lxEntityDashFilterType\"},\"width\":6},{\"column\":0,\"dataConfig\":[],\"displayName\":\"Log Set\",\"height\":1,\"localStorageKey\":\"log-analytics-logset-filter\",\"name\":\"log-analytics-logset-filter\",\"nls\":{},\"parametersMap\":{\"isStoreInLocalStorage\":true},\"row\":0,\"savedSearchId\":\"OOBSS-management-dashboard-filter-3a\",\"state\":\"DEFAULT\",\"uiConfig\":{\"defaultWidth\":6,\"filterName\":\"log-analytics-logset-filter\",\"hidden\":\"$(window.logSetNotEnabled)\",\"internalKey\":\"OOBSS-management-dashboard-filter-3a\",\"minWidth\":6,\"vizFilterType\":\"lxLogSetDashFilterType\"},\"width\":0},{\"displayName\":\"Time\",\"name\":\"time\",\"src\":\"$(context.time)\"}],\"drilldownConfig\":[],\"freeformTags\":{},\"definedTags\":{}}]}"
    regions_map         = { for r in data.oci_identity_regions.these.regions : r.key => r.name } # All regions indexed by region key.
}

data "oci_identity_regions" "these" {}
data oci_identity_tenancy tenancy {
    tenancy_id = var.tenancy_ocid
}

data "oci_logging_log_groups" "oci_log_groups" {
    #Required
    compartment_id = var.iam_dashboard_compartmentid

    #Optional
    display_name = "_Audit_Include_Subcompartment"
    #is_compartment_id_in_subtree = var.log_group_is_compartment_id_in_subtree
}

output "audit_id" {
    value = data.oci_logging_log_groups.oci_log_groups.id
}

data "oci_objectstorage_namespace" "ns" {
  compartment_id             = var.iam_dashboard_compartmentid
}

data "oci_log_analytics_namespaces" "iam_dashboard_namespaces" {
  compartment_id = var.tenancy_ocid
}

resource "oci_log_analytics_namespace" "iam_dashboard_namespace" {
  count = data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.is_onboarded ? 0 : 1
  namespace = data.oci_objectstorage_namespace.ns
  is_onboarded = true
  compartment_id = var.tenancy_ocid
}

resource "null_resource" "wait_on_logan" {
  depends_on = [oci_log_analytics_namespace.iam_dashboard_namespace]
  provisioner "local-exec" {
    command = "sleep 40" # Wait for login analytics to be available.
  }
}

resource "oci_management_dashboard_management_dashboards_import" "iam_dashboard_import" {
    #count = data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.is_onboarded ? 0 : 1
    depends_on = [
      oci_log_analytics_log_analytics_import_custom_content.iam_dashboard_import_custom_content
    ]
    import_details = local.iam_dashboard_details
    #import_details_file = "/Users/gsaurez/test.json"
}

resource "oci_log_analytics_log_analytics_import_custom_content" "iam_dashboard_import_custom_content" {
    # = data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.is_onboarded ? 0 : 1

    #Required
    import_custom_content_file = var.iam_dashboard_import_custom_content_file
    #namespace = oci_log_analytics_namespace.iam_dashboard_namespace.namespace
    namespace = data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.is_onboarded ? data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.namespace : oci_log_analytics_namespace.iam_dashboard_namespace.0.namespace
    #Optional
    expect = var.iam_dashboard_custom_content_expect
    is_overwrite = var.iam_dashboard_custom_content_is_overwrite
}

# Create a log group with required parameters
resource "oci_log_analytics_log_analytics_log_group" "iam_dashboard_log_group" {

  count = (var.create_service_connector_audit  == true ) ? 1 : 0
  compartment_id             = var.iam_dashboard_compartmentid
  #namespace                  = oci_log_analytics_namespace.iam_dashboard_namespace.namespace
  namespace = data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.is_onboarded ? data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.namespace : oci_log_analytics_namespace.iam_dashboard_namespace[count.index].namespace
  display_name               = var.logging_analytics_log_group_name
}

# Get details of above created log group with required parameters
data "oci_log_analytics_log_analytics_log_group" "iam_dashboard_log_group_details" {
  count = (var.create_service_connector_audit  == true ) ? 1 : 0
  #namespace                  = data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.namespace
  namespace = data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.is_onboarded ? data.oci_log_analytics_namespaces.iam_dashboard_namespaces.namespace_collection.0.items.0.namespace : oci_log_analytics_namespace.iam_dashboard_namespace[count.index].namespace
  log_analytics_log_group_id = oci_log_analytics_log_analytics_log_group.iam_dashboard_log_group[count.index].id
}

resource "oci_sch_service_connector" "iam_dashboard_service_connector" {
  count = (var.create_service_connector_audit  == true ) ? 1 : 0
  compartment_id = var.iam_dashboard_compartmentid
  #defined_tags  = {"${oci_identity_tag_namespace.tag-namespace1.name}.${oci_identity_tag.tag1.name}" = "updatedValue"}
  description    = "Used to populate Logging Analytics with OCI Audit Logs"
  display_name   = "IAM Identity Domain Audit to Logging Analytics"


  source {
    kind = "logging"
    #Audit
    log_sources {
      compartment_id = var.iam_dashboard_compartmentid
      log_group_id   = "_Audit"
      log_id = ""
    }
  }
  target {
    kind            = "loggingAnalytics"
    log_group_id    = data.oci_log_analytics_log_analytics_log_group.iam_dashboard_log_group_details[count.index].id
  }

  state = var.service_connector_audit_state
}

resource "oci_identity_policy" "connectorpolicy_logginganalytics" {
  count = (var.create_service_connector_audit  == true ) ? 1 : 0
  name           = "IAM_Dashboard_ConnectorPolicy_LoggingAnalytics"
  description    = "Policy to allow Service Connector to upload logs to a Logging Analytics Log Group"
  compartment_id = var.iam_dashboard_compartmentid
  provider = oci.home

  statements = [
    "allow any-user to {LOG_ANALYTICS_LOG_GROUP_UPLOAD_LOGS} in compartment id ${var.iam_dashboard_compartmentid} where all {request.principal.type='serviceconnector', target.loganalytics-log-group.id='${data.oci_log_analytics_log_analytics_log_group.iam_dashboard_log_group_details[count.index].id}', request.principal.compartment.id='${var.iam_dashboard_compartmentid}'}"
  ]
}